<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Philanthropography</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,100..900;1,9..144,100..900&family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@coreui/coreui@5.1.2/dist/css/coreui.min.css" rel="stylesheet"
    integrity="sha384-lBISJVJ49zh34fnUuAaSAyuYzQ2ioGvhm4As4Z1JFde0kVpaC1FFWD3f9adpZrdD" crossorigin="anonymous">
  <link rel="stylesheet" href="/stylesheets/styles.css" />
  <style>
    * {
      font-family: "Fraunces", serif;
    }

    .header, .footer {
      background-color: #003CE0;
      color: white;
    }

    a {
      color: white;
      text-decoration: underline;
    }

    #WebChatContainer {
      position: absolute;
      right: 0%;
      width: 40%;
      height: 75vh;
      top: 10px;
      bottom: 10px;
    }

    #WACContainer.WACContainer .HideWebChat {
      display: none;
      font-family: "Fraunces", serif;
    }
  </style>
</head>

<header class="header sticky-top">
  <a class="header-brand" style="color: white;">Philanthropography</a>
</header>

<body>
  <div class="card text-bg-dark">
    <img src="https://github.com/SBLANG/easy-to-give-then-receive/blob/main/demoapp/public/images/beggars-sat-beside-street-with-homeless-message-please-help-work-with-food.jpg?raw=true" class="card-img"
      alt="Homeless beggar sitting on street curb with cardboard sign " />
    <div class="card-img-overlay">
      <h1 class="card-title">Easy to give then receive</h1>
      <p class="card-text">
        Welcome to Philanthropography
      </p>
    </div>
  </div>
    <div class="container-fluid">
      <p class="text-end">
        Image by
        <a href="https://www.freepik.com/free-photo/beggars-sat-beside-street-with-homeless-message-please-help-work-with-food_8351927.htm#fromView=search&page=1&position=6&uuid=1ba45b60-3d27-43e2-b05b-9fa072ed229a"
          target="_blank" rel="noreferrer noopener">
          jcomp on Freepik
        </a>
      </p>
    </div>



    <div class="container-fluid" id="WebChatContainer"></div>

    <div class="container text-center">
      <h2 class="text-center">About Us</h2>
      <p>
        Easy to give then receive by
        <strong>Philanthropography</strong> started as part of the
        <strong>2024 Call for Code Global Challenge</strong>. Our mission is
        mobilise ordinary people to help reach the
        <a href="https://sdgs.un.org/2030agenda" target="_blank">2030 Agenda for Sustainable Development</a>. Our project is powered by
        factual, data-driven, generative AI.
      </p>
      <div class="container row">
        <div class="container col card text-bg-dark mb-3" style="max-width: 18rem">
          <div class="container card-header">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width: 30%">
              <path fill="var(--ci-primary-color, currentColor)"
                d="M425.706,86.294A240,240,0,0,0,86.294,425.706,240,240,0,0,0,425.706,86.294Zm-80.04,236.745a111.781,111.781,0,0,0,0-134.078l68.218-68.218a207.579,207.579,0,0,1,0,270.514ZM176,256a80,80,0,1,1,80,80A80.091,80.091,0,0,1,176,256ZM391.257,98.116l-68.218,68.218a111.781,111.781,0,0,0-134.078,0L120.743,98.116a207.579,207.579,0,0,1,270.514,0ZM98.116,120.743l68.218,68.218a111.781,111.781,0,0,0,0,134.078L98.116,391.257a207.579,207.579,0,0,1,0-270.514Zm22.627,293.141,68.218-68.218a111.781,111.781,0,0,0,134.078,0l68.218,68.218a207.579,207.579,0,0,1-270.514,0Z"
                class="ci-primary" />
            </svg>
          </div>
          <div class="container card-body">
            <h5 class="card-title">Request Assistance</h5>
            <p class="card-text">
              Our solution provides an
              <strong>easy and trustworthy</strong> way for ordinary people or
              businesses to express their needs.
            </p>
            <p>
              We understand how hard it can be to ask for help, so we keep
              privacy and dignity at the centre of what we do.
            </p>
          </div>
        </div>
        <div class="container col card text-bg-dark mb-3" style="max-width: 18rem">
          <div class="container card-header">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width: 30%">
              <path fill="var(--ci-primary-color, currentColor)"
                d="M256,16C123.452,16,16,123.452,16,256S123.452,496,256,496,496,388.548,496,256,388.548,16,256,16ZM403.078,403.078a207.253,207.253,0,1,1,44.589-66.125A207.332,207.332,0,0,1,403.078,403.078Z"
                class="ci-primary" />
              <path fill="var(--ci-primary-color, currentColor)"
                d="M256,384A104,104,0,0,0,360,280H152A104,104,0,0,0,256,384Z" class="ci-primary" />
              <polygon fill="var(--ci-primary-color, currentColor)"
                points="205.757 228.292 226.243 203.708 168 155.173 109.757 203.708 130.243 228.292 168 196.827 205.757 228.292"
                class="ci-primary" />
              <polygon fill="var(--ci-primary-color, currentColor)"
                points="285.757 203.708 306.243 228.292 344 196.827 381.757 228.292 402.243 203.708 344 155.173 285.757 203.708"
                class="ci-primary" />
            </svg>
          </div>
          <div class="container card-body">
            <h5 class="card-title">Play Your Part</h5>
            <p class="card-text">
              We help donors find meaningful, SDG-related causes they can
              back. This gives you piece of mind to know that your time and
              resources are really making a difference.
            </p>
          </div>
        </div>
        <div class="container col card text-bg-dark mb-3" style="max-width: 18rem">
          <div class="container card-header">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width: 30%">
              <path fill="var(--ci-primary-color, currentColor)"
                d="M462.541,316.3l-64.344-42.1,24.774-45.418A79.124,79.124,0,0,0,432.093,192V120A103.941,103.941,0,0,0,257.484,43.523L279.232,67a71.989,71.989,0,0,1,120.861,53v72a46.809,46.809,0,0,1-5.215,21.452L355.962,284.8l89.058,58.274a42.16,42.16,0,0,1,19.073,35.421V432h-72v32h104V378.494A74.061,74.061,0,0,0,462.541,316.3Z"
                class="ci-primary" />
              <path fill="var(--ci-primary-color, currentColor)"
                d="M318.541,348.3l-64.343-42.1,24.773-45.418A79.124,79.124,0,0,0,288.093,224V152A104.212,104.212,0,0,0,184.04,47.866C126.723,47.866,80.093,94.581,80.093,152v72a78,78,0,0,0,9.015,36.775l24.908,45.664L50.047,348.3A74.022,74.022,0,0,0,16.5,410.4L16,496H352.093V410.494A74.061,74.061,0,0,0,318.541,348.3ZM320.093,464H48.186l.31-53.506a42.158,42.158,0,0,1,19.073-35.421l88.682-58.029L117.2,245.452A46.838,46.838,0,0,1,112.093,224V152a72,72,0,1,1,144,0v72a46.809,46.809,0,0,1-5.215,21.452L211.962,316.8l89.058,58.274a42.16,42.16,0,0,1,19.073,35.421Z"
                class="ci-primary" />
            </svg>
          </div>
          <div class="container card-body">
            <h5 class="card-title">Augmented Intelligence</h5>
            <p class="card-text">
              Our AI-driven tools help you make informed decision around your
              ESG strategy.
            </p>
          </div>
        </div>
      </div>
    </div>

  <footer class="footer sticky-bottom">
    <div>
        <span>&copy; 2024 Philanthropography</span>
    </div>
  </footer>

  <script>
    /**
     *  This function sets the web chat size and position.
     */
    const customElement = document.getElementById("WebChatContainer");

    function viewChangeHandler(event, instance) {
      if (event.newViewState.mainWindow) {
        instance.elements.getMainWindow().removeClassName("HideWebChat");
      } else {
        instance.elements.getMainWindow().addClassName("HideWebChat");
      }
    }

    /**
     * This is the function that is called when the web chat code has been loaded and it is ready to be rendered.
     */
    async function onLoad(instance) {
      instance.on({ type: "view:change", handler: viewChangeHandler });

      // instance.updateUserID(``)

      instance.on({ type: "send", handler: saveMessage });

      instance.on({ type: "receive", handler: saveMessage, receiveHandler }); // We will need to listen for the "receive" event so we can automatically fill in a form element after
      // getting a response from the assistant.
      instance.on({ type: "history:begin", handler: saveHistory });

      instance.updateCustomMenuOptions("bot", [
        { text: "Download History", handler: doDownload },
      ]);

      // Listen for the userDefinedResponse event that will allow us to create content for the user defined response when one is
      // received. See https://web-chat.global.assistant.watson.cloud.ibm.com/docs.html?to=api-events#summary for more
      // about our events.
      instance.on({
        type: "userDefinedResponse",
        handler: (event, instance) => {
          // The "user_defined_type" property is just an example. It is not required or you can use any other property
          // or condition you want here. This makes it easier to handle different response types if you have more than
          // one user defined response type.
          const { message } = event.data;
          if (
            message.user_defined &&
            message.user_defined.user_defined_type === "fill_requestor_name"
          ) {
            requestorNameResponseHandler(event, instance);
          }
        },
      });

      g_wa_instance = instance;
      instance.on({
        type: "customResponse",
        handler: (event, instance) => {
          if (
            event.data.message.user_defined &&
            event.data.message.user_defined.user_defined_type ===
            "embed-multimedia"
          ) {
            embedChartOrTableHandler(event);
          }
        },
      });

      await instance.render();
    }

    /**
     *  Enable transcript download.
     */
    const messages = [];

    /**
     * This function saves the current message to an array.
     */
    function saveMessage(event) {
      messages.push(event.data);
    }

    /**
     * This function save the chat history to an array.
     */
    function saveHistory(event) {
      messages.push(...event.messages);
    }

    /**
     * This function escapes the given piece of text so it can safely be displayed in a CSV file.
     */
    function escapeCSV(text) {
      // Remove any newline characters which aren't supported in all CSV formats.
      text = text.replace(/\n/g, " ");

      // If the text contains a comma or a double quote, the entire thing needs to be surrounded by double quotes. If
      // the string contains a double quote, then each double quote needs to be replaced with two double quotes.
      if (text.match(/[,"]/)) {
        return `"${text.replace(/"/g, '""')}"`;
      }
      return text;
    }

    /**
     * This function creates a single row of text that will appear in the output file.
     */
    function createDownloadText(from, text) {
      return `${from},${escapeCSV(text)}`;
    }

    function createDownload() {
      const downloadLines = [createDownloadText("From", "Message")];

      messages.forEach((message) => {
        if (message.input?.text) {
          // Message that came from the user.
          downloadLines.push(createDownloadText("You", message.input.text));
        } else if (message.output?.generic?.length) {
          // Message that came from assistant. Can contain an array of individual message items.
          message.output?.generic.forEach((messageItem) => {
            if (messageItem?.text) {
              // Handle text response.
              downloadLines.push(
                createDownloadText("Lendyr", messageItem.text)
              );
            }
          });
        }
      });

      return downloadLines.join("\n");
    }

    /**
     * This function triggers the download of the ouput file.
     */
    function doDownload() {
      const downloadContent = createDownload();

      const blob = new Blob([downloadContent], { type: "text/csv" });
      const url = URL.createObjectURL(blob);

      // To automatically trigger a download, we have to create a fake "a" element and then click it.
      const timestamp = new Date()
        .toISOString()
        .replace(/[_:]/g, "-")
        .replace(/.[0-9][0-9][0-9]Z/, "");
      const a = document.createElement("a");
      a.setAttribute("href", url);
      a.setAttribute("download", `Chat History ${timestamp}.csv`);
      a.click();
    }

    /**
     * This function is called when a user defined response should be rendered in web chat. We will use this to render a
     * custom button which, when clicked, will fill in the requestor name field.
     */
    function requestorNameResponseHandler(event) {
      const { element } = event.data;

      const button = document.createElement("button");
      button.type = "button";
      button.style.marginTop = "16px";
      button.innerHTML = "Fill in requestor name";
      button.addEventListener("click", () => {
        // Look for the requestor name element in the document and fill in the requestor name. You could get this value
        // from a context variable in the message.
        document.querySelector("#requestor-name").value = Requestor_Name;
      });

      const container = document.createElement("div");
      // This class name will allow our button to look like the default buttons used in web chat.
      container.classList.add("ibm-web-chat--default-styles");
      container.appendChild(button);

      element.appendChild(container);
    }

    /**
     * This function will look for the "beneficiary_name" user defined value and if it sees it, will fill in the beneficiary name
     * field.
     */
    function receiveHandler(event) {
      const message = event.data;
      if (
        message.output.generic &&
        message.output.generic[0].user_defined &&
        message.output.generic[0].user_defined.user_defined_type ===
        "fill_beneficiary_name"
      ) {
        // Look for the beneficiary name element in the document and fill in the beneficiary name. You could get this value
        // from a context variable in the message.
        document.querySelector("#beneficiary-name").value = Beneficiary_Name;
      }
    }

    /**
     * This function implements a handler that calls a /getAnswer API to fetch a chart or table in the form of HTML.
     * The response is embedded in the assistant window.
     */
    async function embedChartOrTableHandler(e) {
      const { element, message } = e.data;
      const query = message.user_defined.user_query;

      const SERVER = ""; // backend server URL
      fetch(SERVER + "/getAnswer", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ question: query }),
      }).then(
        async (res) => {
          const response = await res.json();
          if (response.data) {
            const { data } = response;
            element.innerHTML = data;
            messageChatbot("step successful", true);
            return;
          }
          messageChatbot("Some error occured.", true);
        },
        (err) => {
          messageChatbot("Unable to get answer based on your query.", true);
        }
      );
    }

    /* Embed web chat edit the configuration object to customise the appearance and behaviour before it is rendered. 
      Visit https://web-chat.global.assistant.watson.cloud.ibm.com/docs.html?to=api-configuration#configuration-object
      to review the parameters. */
    window.watsonAssistantChatOptions = {
      integrationID: "172046f8-8af2-4730-9991-e25ea7bde2d1", // The ID of this integration.
      region: "us-south", // The region your integration is hosted in.
      serviceInstanceID: "a0ac6602-f8b8-4b0e-9343-df33259cc078", // The ID of your service instance.
      showRestartButton: true,
      debug: true,
      element: customElement,
      closePanelButtonConfig: {
        is_on: false,
      },
      onLoad: onLoad,
    };

    setTimeout(function () {
      const t = document.createElement("script");
      t.src =
        "https://web-chat.global.assistant.watson.appdomain.cloud/versions/" +
        (window.watsonAssistantChatOptions.clientVersion || "latest") +
        "/WatsonAssistantChatEntry.js";
      document.head.appendChild(t);
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@coreui/coreui@5.1.2/dist/js/coreui.bundle.min.js"
    integrity="sha384-yoEOGIfJg9mO8eOS9dgSYBXwb2hCCE+AMiJYavhAofzm8AoyVE241kjON695K1v5"
    crossorigin="anonymous"></script>
</body>

</html>